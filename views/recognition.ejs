<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Revelation</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/fonts.css">
    <link rel="stylesheet" href="/css/cutscene-styles.css">
    <link rel="stylesheet" href="/css/recognition-styles.css">
</head>
<body>

    <section class="cutscene">
        <div class="container-fluid">
            <div class="logo-container">
                <h2>TRAINING MODULE 07</h2>
                <h1>FINAL REVELATION</h1>
            </div>
        </div>
    
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-2">
                    <video id="vid-1" width="320" height="240" class="hidden">
                        <source src="/images/07.webm" type="video/webm">
                    </video>

                    <button id="playPauseBtn">
                        <img src="/images/Play Button_Jarvis.png" alt="">
                    </button>
                </div>
                <div id="clickheretobegin" class="col-md-10">
                    <img src="/images/07 Onboarding.png" alt="">
                </div>
            </div>
        </div>
    </section>

    <section class="level hidden">
        <header>
            <nav class="navbar navbar-expand-lg">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#">
                        <img src="/images/modulelogo.png" alt="Logo" class="logo">
                    </a>
                    <div class="title">
                        <h1>07</h1>
                        <h1>PATTERN RECOGNITION</h1>
                    </div>
                    <div class="collapse navbar-collapse">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="/playerinfo">
                                    <img src="<%= user.playerAvatar %>" alt="Icon" class="icon">
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </header>
    
        <div class="row content">
            <div class="col-md-1 buttons-section">
                <button class="button button-active" data-id="1" style="padding: 23%;">01</button> <br>
                <button class="button button-long" data-id="2">02</button> <br>
                <button class="button" data-id="3">03</button> <br>
                <button class="button" data-id="4">04</button> <br>
                <button class="button" data-id="5">05</button> <br>
                <button class="button" data-id="6">06</button> <br>
            </div>
    
            <div class="col-md-3 clue-section">
                <p id="clue-theme" class="clue-active">_ _ _ _ _ _ _ _ _ _</p>
                <img id="clue-img" src="/images/recognition-empty.png" alt="">
                <p id="clue-title"></p>
                <div class="row" style="height: 8%; margin: 4% 0;">
                    <div class="col-md-2">
                        <img style="height: 50%;" src="/images/recognition/Icon - Pin2.png" alt="">
                    </div>
                    <div class="col-md-10" style="padding-right: 24%; height: 100%;">
                        <p id="clue-location"></p>
                    </div>
                </div>
                <div class="row" style="height: 8%; margin: 4% 0;">
                    <div class="col-md-2">
                        <img style="height: 50%;" src="/images/recognition/Icon - City2.png" alt="">
                    </div>
                    <div class="col-md-10" style="padding-right: 40%; height: 100%;">
                        <p id="clue-city"></p>
                    </div>
                </div>
                <div class="row" style="height: 8%; margin: 4% 0;">
                    <div class="col-md-2">
                        <img style="height: 50%;" src="/images/recognition/Icon - Date2.png" alt="">
                    </div>
                    <div class="col-md-10" style="height: 100%;">
                        <p id="clue-date"></p>
                    </div>
                </div>
            </div>
    
            <div class="col-md-8 content-section">
                <div id="content-1">
                    <div class="row">
                        <div class="col-md-1">
                            <img src="/images/recognition/Icon - Sc1.png" alt="">
                        </div>
                        <div class="col-md-11">
                            <h1>The Professor’s laptop was found unlocked on her table. Can you scroll through her browser history and identify what theme was she searching for?</h1>
                        </div>
                    </div>
    
                    <div class="laptop">
                        <div class="laptop-content">
                            <img src="/images/Browser History.png" alt="Long Scrollable Content">
                        </div>
                    </div>
                    <img id="laptop-base" src="/images/laptop-base.png" alt="">
    
                    <div class="row">
                        <div class="col-md-1">
                            <img src="/images/recognition/Icon-Bulb.png" alt="">
                        </div>
                        <div class="col-md-10">
                            <div class="playerinput">
                                <input type="text" id="clue-1-input" class="form-control" placeholder="Enter Your Guess">
                            </div>
                        </div>
                        <div class="col-md-1">
                            <img src="/images/recognition/Icon-Submit.png" alt="">
                        </div>
                    </div>    
                    
                </div>
    
                <div id="content-2" class="hidden">
                    <div class="row">
                        <div class="col-md-1">
                            <img src="/images/recognition/Icon - Sc2.png" alt="">
                        </div>
                        <div class="col-md-11">
                            <h1>A piece of paper was found on the Professor’s table with a cryptic message, involving a numbered pattern. Can you help decode the message?</h1>
                        </div>
                    </div>
                    
    
                    <div class="content-2-img text-center">
                        <img src="/images/Message.png" alt="">
                    </div>
    
                    <div class="row">
                        <div class="col-md-1">
                            <img src="/images/recognition/Icon-Bulb.png" alt="">
                        </div>
                        <div class="col-md-10">
                            <div class="playerinput">
                                <input type="text" id="clue-2-input" class="form-control" placeholder="Enter Your Guess">
                            </div>
                        </div>
                        <div class="col-md-1">
                            <img src="/images/recognition/Icon-Submit.png" alt="">
                        </div>
                    </div>  
                </div>
    
                <div id="content-3" class="hidden">
                    <div class="row">
                        <div class="col-md-1">
                            <img src="/images/recognition/Icon - Sc3.png" alt="">
                        </div>
                        <div class="col-md-11">
                            <h1>The Professor’s social media contained a series of posts, some of which seem to be related. Can you identify the common element within these posts? </h1>
                        </div>
                    </div>
                    
    
                    <div class="mobile">
                        <div class="mobile-content">
                            <img src="/images/Twitter Feed.png" alt="">
                        </div>
                    </div>
    
                    <div class="row">
                        <div class="col-md-1">
                            <img src="/images/recognition/Icon-Bulb.png" alt="">
                        </div>
                        <div class="col-md-10">
                            <div class="playerinput">
                                <input type="text" id="clue-3-input" class="form-control" placeholder="Enter Your Guess">
                            </div>
                        </div>
                        <div class="col-md-1">
                            <img src="/images/recognition/Icon-Submit.png" alt="">
                        </div>
                    </div>  
                </div>
    
                <div id="content-4" class="hidden">
                    <div class="row">
                        <div class="col-md-1">
                            <img src="/images/recognition/Icon - Sc4.png" alt="">
                        </div>
                        <div class="col-md-11">
                            <h1>A series of polaroid pictures were found taped on a notice board, each with a different shot of the same building. Can you recognize the place? </h1>
                        </div>
                    </div>
                    
    
                    <div id="content4-carousel" class="carousel slide carousel-fade text-center">
                        <div class="carousel-inner">
                            <div class="carousel-item active">
                                <img src="/images/Polaroid Photo_1.png" alt="">
                            </div>
                            <div class="carousel-item">
                                <img src="/images/Polaroid Photo_2.png" alt="">
                            </div>
                            <div class="carousel-item">
                                <img src="/images/Polaroid Photo_3.png" alt="">
                            </div>
                            <div class="carousel-item">
                                <img src="/images/Polaroid Photo_4.png" alt="">
                            </div>
                            <div class="carousel-item">
                                <img src="/images/Polaroid Photo_5.png" alt="">
                            </div>
                            <div class="carousel-item">
                                <img src="/images/Polaroid Photo_6.png" alt="">
                            </div>
                        </div>
                        <button class="carousel-control-prev" type="button" data-target="#content4-carousel" data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                          </button>
                          <button class="carousel-control-next" type="button" data-target="#content4-carousel" data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                          </button>
                    </div>
    
                    <div class="row">
                        <div class="col-md-1">
                            <img src="/images/recognition/Icon-Bulb.png" alt="">
                        </div>
                        <div class="col-md-10">
                            <div class="playerinput">
                                <input type="text" id="clue-4-input" class="form-control" placeholder="Enter Your Guess">
                            </div>
                        </div>
                        <div class="col-md-1">
                            <img src="/images/recognition/Icon-Submit.png" alt="">
                        </div>
                    </div>  
                </div>
    
                <div id="content-5" class="hidden">
                    <div class="row">
                        <div class="col-md-1">
                            <img src="/images/recognition/Icon - Sc5.png" alt="">
                        </div>
                        <div class="col-md-11">
                            <h1>A trail of footprints were discovered on a map. Chances are that it guide us to the Professor. Can you follow the trail and uncover the secret location?</h1>
                        </div>
                    </div>
                    
    
                    <div id="content5-carousel" class="carousel slide carousel-fade text-center" data-ride= "carousel">
                        <div class="carousel-inner">
                            <div class="carousel-item active">
                                <img src="/images/Trail_1.png" alt="">
                            </div>
                            <div class="carousel-item">
                                <img src="/images/Trail_2.png" alt="">
                            </div>
                            <div class="carousel-item">
                                <img src="/images/Trail_3.png" alt="">
                            </div>
                            <div class="carousel-item">
                                <img src="/images/Trail_4.png" alt="">
                            </div>
                            <div class="carousel-item">
                                <img src="/images/Trail_5.png" alt="">
                            </div>
                            <div class="carousel-item">
                                <img src="/images/Trail_6.png" alt="">
                            </div>
                            <div class="carousel-item">
                                <img src="/images/Trail_7.png" alt="">
                            </div>
                            <div class="carousel-item">
                                <img src="/images/Trail_8.png" alt="">
                            </div>
                            <div class="carousel-item">
                                <img src="/images/Trail_9.png" alt="">
                            </div>
                            <div class="carousel-item">
                                <img src="/images/Trail_10.png" alt="">
                            </div>
                        </div>
                        <button class="carousel-control-prev" type="button" data-target="#content5-carousel" data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                          </button>
                          <button class="carousel-control-next" type="button" data-target="#content5-carousel" data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                          </button>
                    </div>
    
                    <div class="row">
                        <div class="col-md-1">
                            <img src="/images/recognition/Icon-Bulb.png" alt="">
                        </div>
                        <div class="col-md-10">
                            <div class="playerinput">
                                <input type="text" id="clue-5-input" class="form-control" placeholder="Enter Your Guess">
                            </div>
                        </div>
                        <div class="col-md-1">
                            <img src="/images/recognition/Icon-Submit.png" alt="">
                        </div>
                    </div>  
                </div>
    
                <div id="content-6" class="hidden">
                    <div class="row">
                        <div class="col-md-1">
                            <img src="/images/recognition/Icon - Sc6.png" alt="">
                        </div>
                        <div class="col-md-11">
                            <h1>The Professor sent a series of emails to several people before she went missing. Can you identify a common pattern within these emails?</h1>
                        </div>
                    </div>
                    
    
                    <div id="content6-carousel" class="carousel slide carousel-fade text-center" data-ride= "carousel">
                        <div class="carousel-inner">
                            <div class="carousel-item active">
                                <img src="/images/Email1.png" alt="">
                            </div>
                            <div class="carousel-item">
                                <img src="/images/Email2.png" alt="">
                            </div>
                            <div class="carousel-item">
                                <img src="/images/Email3.png" alt="">
                            </div>
                            <div class="carousel-item">
                                <img src="/images/Email4.png" alt="">
                            </div>
                            <div class="carousel-item">
                                <img src="/images/Email5.png" alt="">
                            </div>
                        </div>
                        <button class="carousel-control-prev" type="button" data-target="#content6-carousel" data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                          </button>
                          <button class="carousel-control-next" type="button" data-target="#content6-carousel" data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                          </button>
                    </div>
    
                    <div class="row">
                        <div class="col-md-1">
                            <img src="/images/recognition/Icon-Bulb.png" alt="">
                        </div>
                        <div class="col-md-10">
                            <div class="playerinput">
                                <input type="text" id="clue-6-input" class="form-control" placeholder="Enter Your Guess">
                            </div>
                        </div>
                        <div class="col-md-1">
                            <img src="/images/recognition/Icon-Submit.png" alt="">
                        </div>
                    </div>  
                </div>
            </div>
    
            <div class="end-screen hidden">
                <div class="end-img">
                    <img src="/images/dudley.jpeg" alt="">
                </div>
    
                <div class="row end-text">
                    <div class="col-md-1">
                        <img src="/images/JarvisImg.png" alt="">
                    </div>
                    <div class="col-md-11">
                        <p style="color: #FFD977;">Congratulations, Agents! You have successfully deciphered the secret trail of clues left by the Professor. We are thrilled to invite you to the groundbreaking Purdue X Google Summit, to be held in Indianapolis.  You will have the opportunity to connect with leading experts, gain valuable knowledge, and contribute to shaping the role of AI in education, business, and government. See you at the summit, and together, let's pioneer the future of AI!</p>
                    </div>
                </div>
    
                <div class="submit-button btn-container">
                    <button id="step-1-submit" class="btn btn-warning" style="margin-right: 10%;">PROCEED</button>
                </div>
            </div>
        </div>
    </section>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>

        const clueDict = {1: "clue-theme", 2: "clue-img", 3: "clue-title", 4: "clue-location", 5: "clue-city", 6: "clue-date"};

        let activeButtonId = 1;

        let score = 0;

        const video = document.getElementById('vid-1');
        const playPauseBtn = document.getElementById('playPauseBtn');

        // Play/Pause functionality
        playPauseBtn.addEventListener('click', () => {
            if (video.paused || video.ended) {
                video.play();
                playPauseBtn.style.display = 'none';

                playPauseBtn.classList.add("hidden");
                video.classList.remove("hidden");
            }
        });

        document.getElementById("clickheretobegin").addEventListener('click', function(event) {
                document.querySelector(".cutscene").classList.add("hidden");
                document.querySelector(".level").classList.remove("hidden");
        }, { once: true });

        function setActive(button) {
            var buttons = document.querySelectorAll('.button');
            buttons.forEach(function(btn) {
                btn.classList.remove('button-active');
            });

            button.classList.add('button-active');

            document.getElementById(clueDict[activeButtonId]).classList.remove('clue-active');

            activeButtonId = button.getAttribute('data-id');

            document.getElementById(clueDict[activeButtonId]).classList.add('clue-active');

            var contents = document.querySelectorAll('div[id^="content-"]');
            contents.forEach(function(content) {
                content.classList.add('hidden');
            });

            var activeContent = document.getElementById('content-' + activeButtonId);
            if (activeContent) {
                activeContent.classList.remove('hidden');
            }
        }

        document.querySelectorAll('.button').forEach(button => {
            button.addEventListener('click', function() {
                setActive(this);
            });
        });

        document.addEventListener("DOMContentLoaded", function() {

            const hints = {
                1: "Was the Professor planning something?",
                2: "A Group of Numbers... They must have a meaning",
                3: "A common name repeated frequently", 
                4: "Something is common across these polaroids", 
                5: "Ahh, a trail of footsteps... Does the Professor point to some location?", 
                6: "Is there something consistent across these emails?"
            };

            const submitButtons = document.querySelectorAll("img[src='/images/recognition/Icon-Submit.png']");
            const hintIcons = document.querySelectorAll("img[src='/images/recognition/Icon-Bulb.png']");

            document.getElementById("clickheretobegin").addEventListener('click', function(event) {
                document.querySelector(".cutscene").classList.add("hidden");
                document.querySelector(".level").classList.remove("hidden");
            }, { once: true });

            submitButtons.forEach(function(button, index){

                button.addEventListener("click", function(){

                    const inputField = document.getElementById(`clue-${index + 1}-input`);
                    const userInput = inputField.value.trim().toLowerCase();

                    fetch('/recognition/answers', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            clueNumber: index + 1, 
                            answer: userInput
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if(data.correct) {
                            inputField.style.boxShadow = "0 0 0px 2px lightgreen";
                            console.log(`Correct answer for content-${index + 1}`);

                            if (index + 1 == 2){
                                document.getElementById(clueDict[index + 1]).src = data.text;
                            } else{
                                document.getElementById(clueDict[index + 1]).textContent = data.text;
                            }

                            
                            document.getElementById(clueDict[index + 1]).classList.remove("clue-active");
                            document.getElementById(clueDict[index + 1]).style.boxShadow = "none";

                            score += 1;

                            if (score >= 6){
                                
                                setTimeout(() => {
                                    document.querySelector('.buttons-section').classList.add('hidden');
                                    document.querySelector('.clue-section').classList.add('hidden');
                                    document.querySelector('.content-section').classList.add('hidden');

                                    document.querySelector('.end-screen').classList.remove('hidden');
                                }, 1000);
                                
                            }

                        } else {
                            inputField.style.boxShadow = "0 0 0px 2px lightcoral";
                            console.log(`Wrong answer for content-${index + 1}`);
                        }
                    })
                    .catch(error => console.error('Error:', error));
                });
            });

            hintIcons.forEach(function(icon, index) {
                icon.addEventListener("click", function() {
                    const inputField = document.getElementById(`clue-${index + 1}-input`);
                    const hint = hints[index + 1];
                    inputField.placeholder = hint;
                });
            });

            document.getElementById('step-1-submit').addEventListener('click', () => {
                fetch('/recognition/complete', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.message === 'Troop and avatar updated') {
                            console.log("Updated user");
                            window.location.href = '/levels';
                        }
                    })
                    .catch(error => console.error('Error:', error));
            }); 
        });

    </script>
    
</body>
</html>
